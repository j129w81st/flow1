<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Cannabis Flowchart</title>

  <!-- 1) Mermaid -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <!-- 2) Styles -->
  <style>
    html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#000; }
    #flow-widget {
      display:grid;
      grid-template-columns:auto 1fr 320px;
      height:100vh;
    }
    .zoom-pad {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:.5rem;
      background:#000;
    }
    .zoom-pad button {
      background:#fff;
      border:none;
      padding:.5rem 1rem;
      font-size:1rem;
      cursor:pointer;
    }
    .board {
      background:#fff;
      position:relative;
      overflow:hidden;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    #canvas { transform-origin:0 0; }
    #canvas.grab { cursor:grab; }
    #canvas.grabbing { cursor:grabbing; }
    #info {
      background:#fff;
      padding:1rem;
      overflow-y:auto;
    }
    #info h2 { margin-top:0; }
  </style>

  <!-- 3) JS: init, zoom/pan & info callbacks -->
  <script>
    document.addEventListener('DOMContentLoaded',()=>{
      // Mermaid init
      mermaid.initialize({ startOnLoad:true, securityLevel:'loose', flowchart:{ htmlLabels:true } });
      window.mermaid.parseError = e=>console.error('Mermaid parse error ‚Üí',e);

      // Zoom/Pan
      let s=1, ox=0, oy=0, drag=false, startX, startY;
      window.zoomIn = ()=>{ s*=1.2; apply(); };
      window.zoomOut= ()=>{ s/=1.2; apply(); };
      window.resetZoom= ()=>{ s=1; ox=oy=0; apply(); };
      function apply(){
        const c=document.getElementById('canvas');
        if(c) c.style.transform=`translate(${ox}px,${oy}px) scale(${s})`;
      }
      // Wait for SVG to render
      setTimeout(()=>{
        const c=document.querySelector('#flow-widget .mermaid svg');
        if(!c) return;
        c.id='canvas';
        c.classList.add('grab');
        c.addEventListener('mousedown',e=>{
          drag=true;
          startX=e.clientX-ox;
          startY=e.clientY-oy;
          c.classList.add('grabbing');
        });
        c.addEventListener('mousemove',e=>{
          if(!drag) return;
          ox=e.clientX-startX;
          oy=e.clientY-startY;
          apply();
        });
        ['mouseup','mouseleave'].forEach(ev=>{
          c.addEventListener(ev,()=>{
            drag=false;
            c.classList.remove('grabbing');
          });
        });
      },200);

      // Info data & callback
      const infoMap = {
        A:['Live Cannabis Plant','Living plant with cannabinoids & terpenes‚Ä¶'],
        B1:['Cut & Freeze','Harvest and flash-freeze‚Ä¶'],
        B2:['Dry/Cure Path','Traditional workflow:‚Ä¶'],
        B3:['Dry-sift Path','Material destined for kief‚Ä¶'],
        /* ‚Ä¶ all the rest exactly as before ‚Ä¶ */
        X3:['Waste','Spent biomass discarded or composted.']
      };
      window.showInfo=id=>{
        if(!infoMap[id])return;
        document.getElementById('title').textContent=infoMap[id][0];
        document.getElementById('body').textContent=infoMap[id][1];
      };
    });
  </script>
</head>

<body>
  <div id="flow-widget">
    <div class="zoom-pad">
      <button onclick="zoomIn()">‚ûï Zoom In</button>
      <button onclick="zoomOut()">‚ûñ Zoom Out</button>
      <button onclick="resetZoom()">üîÑ Reset</button>
    </div>
    <div class="board">
      <div class="mermaid">
flowchart LR
  %% ROOT
  A((üåø Live Cannabis Plant))
    A --> B1["‚ùÑÔ∏è Cut & Freeze"]
    A --> B2["üå¨Ô∏è Cut / Trim / Dry / Cure"]
    A --> B3["üîÅ Cut & Sift"]
  %% FRESH-FROZEN
    B1 --> C1["ü•∂ Fresh Frozen Plant"]
    C1 --> D1["üßä Ice Water Extraction"]
    C1 --> D2["üí• Hydrocarbon Extraction"]
    C1 --> D3["üß™ CO‚ÇÇ Extraction"]
    C1 --> D4["üç∏ Ethanol Extraction"]
    D1 --> E1["üíß Bubble Hash"]
    E1 --> F1["üå¨Ô∏è Dry Hash"]
    F1 --> G1["‚ú® Bubble Hash (dry)"]
    G1 --> H1["‚è© Use or Press"]
    H1 --> I1["üî• Press ‚Üí Rosin"]
    H1 --> I2["üß± Press ‚Üí Hashish"]
    I1 --> J1["üíé Live Rosin"]
    I2 --> J2["üî∏ Hash Block"]
    D2 --> L1["üß™ Live Resin"]
    L1 --> L2["üî• Purge"]
    L2 --> L3["üí® Resin Vape"]
    L1 --> L4["‚è≥ Crystalize"]
    L4 --> L5["üí† THCA Diamonds"]
    L4 --> L6["üíß Terp Sauce"]
    D3 --> M1["üí• Crude CO‚ÇÇ Oil"]
    M1 --> M2["üå∫ Capture Terpenes"]
    M1 --> M3["üßä Winterize"]
    M3 --> M4["üßº Refined Oil"]
    M4 --> M5["üî¨ Distill"]
    M5 --> M6["üèÅ THC Distillate"]
    M6 --> V1["üõ†Ô∏è Vape"]
    M6 --> V2["üç¨ Edibles"]
    M6 --> V3["üíä Capsules"]
    M6 --> V4["üß¥ Topicals"]
    M2 --> Y1["üåº Terpenes"]
    Y1 --> V1
    D4 --> N1["üß™ Crude Ethanol"]
    N1 --> N2["‚ùÑÔ∏è Winterize"]
    N2 --> N3["üßº Refined"]
    N3 --> N4["üî• Decarb"]
    N4 --> N5["üåà Full Spectrum"]
    N5 --> V2
    N5 --> V3
    N3 --> N6["üî¨ Distill"]
    N6 --> N7["üèÅ Distillate"]
    N7 --> V1
    N7 --> V2
    N7 --> V3
    N7 --> V4
  %% DRIED-FLOWER
    B2 --> P1["üçÉ Remove Leaves"]
    P1 --> P2["ü™± Compost"]
    P1 --> P3["üí® Hang Dry"]
    P3 --> P4["‚úÇÔ∏è Trim"]
    P4 --> P5["ü´ô Cure"]
    P5 --> P6["üå∏ Cured Flower"]
    P6 --> Q1["üö¨ Flower"]
    P6 --> Q2["üì¶ Pre-roll"]
    P6 --> Q3["üî• Press Rosin"]
    Q3 --> R1["üíé Rosin"]
    P6 --> Q4["ü™∫ Sift ‚Üí Kief"]
    Q4 --> R2["üåø Kief"]
    R2 --> S1["Loose"]
    R2 --> S2["Press"]
    S2 --> R1
    P6 --> Q5["üß™ Solvent Extract"]
    Q5 --> R3["üí• BHO"]
    Q5 --> R4["üß™ Crude Oil"]
    R4 --> R5["üßä Winterize"]
    R5 --> R6["üßº Refined"]
    R6 --> R7["üî¨ Distill"]
    R7 --> R8["üèÅ Distillate"]
    R8 --> V1
    R8 --> V2
    R8 --> V3
    R8 --> V4
    P6 --> Q6["üî• Decarb"]
    Q6 --> Q7["üçØ Infuse Oil"]
    Q7 --> V2
    Q7 --> V3
    Q7 --> V4
  %% DRY-SIFT
    B3 --> S10["üß∫ Dry Sift"]
    S10 --> S11["üåø Kief"]
    S11 --> S1
    S11 --> S2
    S10 --> X3["üóëÔ∏è Waste"]
  %% CLICK CALLBACKS
  click A  callback showInfo
  click B1 callback showInfo
  click B2 callback showInfo
  click B3 callback showInfo
  click C1 callback showInfo
  click D1 callback showInfo
  click D2 callback showInfo
  click D3 callback showInfo
  click D4 callback showInfo
  click E1 callback showInfo
  click F1 callback showInfo
  click G1 callback showInfo
  click H1 callback showInfo
  click I1 callback showInfo
  click I2 callback showInfo
  click J1 callback showInfo
  click J2 callback showInfo
  click L1 callback showInfo
  click L2 callback showInfo
  click L3 callback showInfo
  click L4 callback showInfo
  click L5 callback showInfo
  click L6 callback showInfo
  click M1 callback showInfo
  click M2 callback showInfo
  click M3 callback showInfo
  click M4 callback showInfo
  click M5 callback showInfo
  click M6 callback showInfo
  click V1 callback showInfo
  click V2 callback showInfo
  click V3 callback showInfo
  click V4 callback showInfo
  click Y1 callback showInfo
  click N1 callback showInfo
  click N2 callback showInfo
  click N3 callback showInfo
  click N4 callback showInfo
  click N5 callback showInfo
  click N6 callback showInfo
  click N7 callback showInfo
  click P1 callback showInfo
  click P2 callback showInfo
  click P3 callback showInfo
  click P4 callback showInfo
  click P5 callback showInfo
  click P6 callback showInfo
  click Q1 callback showInfo
  click Q2 callback showInfo
  click Q3 callback showInfo
  click R1 callback showInfo
  click Q4 callback showInfo
  click R2 callback showInfo
  click S1 callback showInfo
  click S2 callback showInfo
  click R3 callback showInfo
  click R4 callback showInfo
  click R5 callback showInfo
  click R6 callback showInfo
  click R7 callback showInfo
  click R8 callback showInfo
  click Q5 callback showInfo
  click Q6 callback showInfo
  click Q7 callback showInfo
  click S10 callback showInfo
  click S11 callback showInfo
  click X3 callback showInfo
      </div>
    </div>

    <div id="info">
      <h2 id="title">Hover or click a step ‚Üí</h2>
      <p id="body">Full explanations appear here.</p>
    </div>
  </div>
</body>
</html>
